<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Progress Map — Standalone Demo</title>
  <style>
    :root{
      --bg:#e9fbfb; --accent:#2dd4bf; --accent-2:#60a5fa; --card-bg: rgba(255,255,255,0.95);
      --shadow: 0 10px 25px rgba(16,24,40,0.08); --muted:#64748b; --ink:#0f172a;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg, var(--bg), #f6fdfd); display:flex; align-items:center; justify-content:center; padding:16px;}

    .phone{ width:360px; height:720px; border-radius:18px; background:linear-gradient(180deg,#f8ffff,#f2fbfb);
      box-shadow: 0 10px 30px rgba(2,6,23,0.12); padding:18px; position:relative; overflow:hidden; border:6px solid rgba(0,0,0,0.03); }
    header{ display:flex; gap:8px; align-items:center; margin-bottom:8px }
    .btn{ padding:8px 14px; border-radius:999px; font-weight:600; cursor:pointer; border:none }
    .btn-advance{ background:var(--accent); color:white; box-shadow:0 6px 14px rgba(45,212,191,0.18) }
    .btn-close{ background:rgba(255,255,255,0.8); color:#222; border:1px solid rgba(0,0,0,0.04) }

    .canvas{ position:relative; width:100%; height:calc(100% - 60px); border-radius:12px; overflow:auto;
      background:linear-gradient(180deg, rgba(255,255,255,0.6), rgba(245,255,255,0.72));
      box-shadow: inset 0 0 0 1px rgba(0,0,0,0.03); }
    .stage{ position:relative; width:100%; height:1200px; }
    svg{ width:100%; height:100%; position:absolute; inset:0 }

    .step{ width:72px; height:72px; border-radius:14px; background:var(--card-bg); box-shadow:var(--shadow);
      display:flex; align-items:center; justify-content:center; position:absolute; transform:translate(-50%,-50%);
      transition:transform .28s cubic-bezier(.2,.9,.4,1), box-shadow .2s ease, background .2s ease;
      padding:8px; overflow:visible; cursor:pointer; will-change:transform }
    .step.small{ width:60px; height:60px; border-radius:12px }
    .step .num{ font-weight:700; color:#1f2937 }
    .step .avatar-hex{ width:40px; height:40px; display:flex; align-items:center; justify-content:center; font-weight:700; color:white; font-size:13px; clip-path:polygon(25% 6.7%,75% 6.7%,100% 50%,75% 93.3%,25% 93.3%,0% 50%) }

    .step--active{ transform:translate(-50%,-50%) scale(1.06); box-shadow:0 18px 40px rgba(15,23,42,0.14) }

    .meta{ position:absolute; left:14px; bottom:14px; color:var(--muted); font-size:13px }

    .corner{ position:absolute; right:-6px; top:-6px; width:28px; height:28px; border-radius:10px; background:linear-gradient(180deg,#fff,#f3f7ff);
      display:flex; align-items:center; justify-content:center; font-size:11px; box-shadow:0 4px 12px rgba(2,6,23,0.06) }

    .tooltip{ position:absolute; transform:translate(-50%,-120%); left:50%; top:0; padding:8px 10px; border-radius:8px; background:white;
      box-shadow:var(--shadow); font-size:13px; white-space:nowrap; pointer-events:none; opacity:0; transition:opacity .2s ease }
    .tooltip.visible{ opacity:1 }

    @media (max-width:420px){ .phone{ width:320px } }
  </style>
</head>
<body>
  <div class="phone" id="phone">
    <header>
      <button class="btn btn-advance" id="advanceBtn">Advance</button>
      <button class="btn btn-close" id="closeBtn">Close</button>
    </header>

    <div class="canvas" id="canvas">
      <div class="stage" id="stage">
        <svg id="svg" viewBox="0 0 360 1200" preserveAspectRatio="xMidYMid meet">
          <defs>
            <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#6ee7b7" stop-opacity="0.9"/>
              <stop offset="100%" stop-color="#60a5fa" stop-opacity="0.95"/>
            </linearGradient>
          </defs>
          <!-- Winding vertical track -->
          <path id="track" d="M40,80 C120,0 160,160 80,240 C0,320 200,380 280,300 C340,240 320,440 190,520 C100,600 260,720 120,840 C40,920 200,980 280,900 C340,840 300,1040 160,1120" stroke="url(#g1)" stroke-width="14" fill="none" stroke-linecap="round" stroke-linejoin="round" opacity="0.95"/>
        </svg>
        <!-- steps injected here -->
        <div class="meta">Tap a step or use Advance to move.</div>
      </div>
    </div>
  </div>

  <script>
    // ---------- Data ----------
    const steps = [
      {id:1,label:'01', initials:'YA', color:'#10b981'},
      {id:2,label:'02', initials:'AL', color:'#06b6d4'},
      {id:3,label:'03', initials:'YO', color:'#34d399'},
      {id:4,label:'04', initials:'RK', color:'#60a5fa'},
      {id:5,label:'05', initials:'SS', color:'#7c3aed'},
      {id:6,label:'06', initials:'MJ', color:'#f97316'}
    ];

    // ---------- Elements ----------
    const svg = document.getElementById('svg');
    const path = document.getElementById('track');
    const canvas = document.getElementById('canvas');
    const stage = document.getElementById('stage');
    const advanceBtn = document.getElementById('advanceBtn');
    const closeBtn = document.getElementById('closeBtn');

    let activeIndex = 0;
    const nodes = []; // DOM elements
    let nodeCenters = []; // {x,y} relative to stage

    // ---------- Helpers ----------
    function clamp(v, min, max){ return Math.max(min, Math.min(max, v)); }
    function centerOn(index){
      const p = nodeCenters[index]; if(!p) return;
      const desired = p.y - canvas.clientHeight/2;
      const maxScroll = stage.clientHeight - canvas.clientHeight;
      canvas.scrollTo({ top: clamp(desired, 0, Math.max(0, maxScroll)), behavior: 'smooth' });
    }
    function setActive(i){
      nodes.forEach((el, idx)=> el.classList.toggle('step--active', idx===i));
      nodes.forEach((el, idx)=> {
        const tip = el.querySelector('.tooltip');
        if (tip) tip.classList.toggle('visible', idx===i);
      });
      activeIndex = i; centerOn(i);
    }

    // Compute a sequence of positions along the path that avoids overlaps
    function computePositions(){
      const L = path.getTotalLength();
      const paddingStart = 0.06 * L, paddingEnd = 0.06 * L; // keep margins
      const usable = L - paddingStart - paddingEnd;
      const minSpacing = 110; // px center-to-center minimum spacing to avoid overlap
      const stepInc = usable / (steps.length * 16); // incremental search step along path

      const stageRect = stage.getBoundingClientRect();
      const ctm = svg.getScreenCTM();

      const centers = [];
      let s = paddingStart;
      for (let i=0;i<steps.length;i++){
        const baseT = i/(steps.length-1);
        const offset = Math.sin(i*1.7)*0.03; // subtle variation
        let sCandidate = paddingStart + clamp(baseT+offset,0,1) * usable;
        // ensure spacing from previous nodes
        if (i>0){
          let guard = 0;
          while (guard < 200) {
            const pPrev = centers[i-1];
            const pPt = path.getPointAtLength(sCandidate);
            const pt = svg.createSVGPoint(); pt.x = pPt.x; pt.y = pPt.y;
            const tr = pt.matrixTransform(ctm);
            const cx = tr.x - stageRect.left; const cy = tr.y - stageRect.top;
            const dx = cx - pPrev.x, dy = cy - pPrev.y;
            const dist = Math.hypot(dx,dy);
            if (dist >= minSpacing) break;
            sCandidate = Math.min(paddingStart + usable, sCandidate + stepInc);
            guard++;
          }
        }
        const p = path.getPointAtLength(sCandidate);
        const pt = svg.createSVGPoint(); pt.x = p.x; pt.y = p.y;
        const tr = pt.matrixTransform(ctm);
        // clamp to keep inside horizontal bounds
        const padX = 40; // inner margin so cards don't clip
        const x = clamp(tr.x - stageRect.left, padX, stage.clientWidth - padX);
        const y = tr.y - stageRect.top;
        centers.push({x,y});
      }
      nodeCenters = centers;
    }

    function renderNodes(){
      // clear existing
      nodes.splice(0).forEach(el => el.remove());

      nodeCenters.forEach((p, i)=>{
        const s = steps[i];
        const el = document.createElement('div');
        el.className = 'step' + (i>1? ' small':'');
        el.dataset.index = i;
        el.style.left = p.x + 'px';
        el.style.top = p.y + 'px';
        el.innerHTML = `
          <div style="display:flex;flex-direction:column;align-items:center;gap:6px;">
            <div class="avatar-hex" style="background:${s.color}">${s.initials}</div>
            <div class="num">${s.label}</div>
          </div>
          <div class="corner">✓</div>
          <div class="tooltip">Step ${s.label} — ${s.initials}</div>
        `;
        el.addEventListener('click', ()=> setActive(i));
        stage.appendChild(el); nodes.push(el);
      });
    }

    function layout(){ computePositions(); renderNodes(); setActive(activeIndex); }

    // ---------- Events ----------
    advanceBtn.addEventListener('click', ()=>{
      if (activeIndex < steps.length - 1){ setActive(activeIndex + 1); }
    });
    closeBtn.addEventListener('click', ()=>{ setActive(0); });

    window.addEventListener('resize', ()=>{ layout(); });

    // ---------- Init ----------
    layout();
  </script>
</body>
</html>
